{% extends 'admin_panel/base_admin.html' %}
{% load static %}

{% block title %}Marketing Studio{% endblock %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&family=Syne:wght@500;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --studio-ink: #0f172a;
    --studio-muted: #6b7280;
    --studio-accent: #ff6b35;
    --studio-accent-2: #0ea5a6;
    --studio-bg: #f8fafc;
  }

  .studio-header h4 {
    font-family: "Space Grotesk", sans-serif;
    font-weight: 700;
    color: var(--studio-ink);
  }

  .studio-subtext {
    color: var(--studio-muted);
  }

  .studio-card {
    border: 1px solid #e5e7eb;
    border-radius: 14px;
    background: #ffffff;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.05);
  }

  .studio-card .card-header {
    background: #ffffff;
    border-bottom: 1px solid #eef2f7;
  }

  .studio-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--studio-ink);
  }

  .studio-input {
    border-radius: 10px;
  }

  .studio-pill {
    border-radius: 999px;
    padding: 0.45rem 0.9rem;
    font-weight: 600;
  }

  .studio-pill.active {
    background: var(--studio-ink);
    color: #ffffff;
  }

  .idea-output,
  .copy-output {
    min-height: 120px;
    font-size: 0.9rem;
  }

  .template-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 0.75rem;
  }

  .filter-pill {
    border: 1px solid #e5e7eb;
    border-radius: 999px;
    padding: 0.3rem 0.75rem;
    font-weight: 600;
    background: #ffffff;
    font-size: 0.8rem;
  }

  .filter-pill.active {
    background: var(--studio-ink);
    color: #ffffff;
  }

  .palette-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 0.5rem;
  }

  .palette-btn,
  .font-btn,
  .badge-btn,
  .cta-btn {
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 0.6rem 0.75rem;
    background: #ffffff;
    font-weight: 600;
    font-size: 0.85rem;
    text-align: left;
  }

  .palette-btn.active,
  .font-btn.active,
  .badge-btn.active,
  .cta-btn.active {
    border-color: var(--studio-accent);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.18);
  }

  .template-btn {
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    background: #ffffff;
    padding: 0.8rem;
    text-align: left;
    font-weight: 600;
  }

  .template-btn.active {
    border-color: var(--studio-accent);
    box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.18);
  }

  .ad-stage {
    border-radius: 16px;
    background: var(--studio-bg);
    padding: 1rem;
    overflow: auto;
  }

  .ad-canvas {
    --canvas-w: 540px;
    --canvas-h: 540px;
    --font-body: "Space Grotesk", sans-serif;
    --font-title: "Playfair Display", serif;
    --ink: var(--studio-ink);
    --muted: var(--studio-muted);
    --accent: var(--studio-accent);
    --accent-2: var(--studio-accent-2);
    --canvas-bg: #ffffff;
    width: var(--canvas-w);
    height: var(--canvas-h);
    background: var(--canvas-bg);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
    font-family: var(--font-body);
    color: var(--ink);
  }

  .ad-canvas .brand-logo {
    position: absolute;
    top: 24px;
    left: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
  }

  .brand-logo img {
    height: 32px;
    width: auto;
  }

  .ad-title {
    font-family: var(--font-title);
    font-size: 2.1rem;
    font-weight: 700;
    line-height: 1.1;
  }

  .ad-tagline {
    font-size: 1rem;
    color: var(--muted);
  }

  .ad-cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.55rem 1.1rem;
    border-radius: 999px;
    background: var(--accent);
    color: #ffffff;
    font-weight: 700;
    font-size: 0.95rem;
  }

  .ad-price {
    font-size: 1.2rem;
    font-weight: 700;
  }

  .ad-badge {
    position: absolute;
    padding: 0.4rem 0.85rem;
    border-radius: 999px;
    font-weight: 700;
    background: var(--accent-2);
    color: #ffffff;
    font-size: 0.85rem;
  }

  .ad-product-img {
    width: 240px;
    height: 320px;
    object-fit: cover;
    border-radius: 16px;
    box-shadow: 0 16px 32px rgba(15, 23, 42, 0.18);
    background: #e2e8f0;
  }

  .product-visual {
    position: relative;
    width: 240px;
    height: 320px;
  }

  .product-image,
  .product-image-alt {
    position: absolute;
    inset: 0;
  }

  .product-image-alt {
    display: none;
  }

  .mode-before-after .product-image {
    clip-path: inset(0 0 0 50%);
  }

  .mode-before-after .product-image-alt {
    display: block;
    clip-path: inset(0 50% 0 0);
  }

  .before-after-divider {
    position: absolute;
    top: 8px;
    bottom: 8px;
    left: 50%;
    width: 2px;
    background: rgba(15, 23, 42, 0.6);
    display: none;
  }

  .before-after-label {
    position: absolute;
    top: 10px;
    padding: 0.25rem 0.6rem;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.75);
    color: #ffffff;
    font-size: 0.75rem;
    display: none;
  }

  .before-label { left: 12px; }
  .after-label { right: 12px; }

  .mode-before-after .before-after-divider,
  .mode-before-after .before-after-label {
    display: block;
  }

  .ugc-frame {
    position: absolute;
    inset: 18px;
    border: 2px solid rgba(15, 23, 42, 0.18);
    border-radius: 18px;
    pointer-events: none;
    display: none;
  }

  .ugc-label {
    position: absolute;
    bottom: 16px;
    left: 16px;
    background: rgba(15, 23, 42, 0.85);
    color: #ffffff;
    padding: 0.35rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .ugc-on .ugc-frame {
    display: block;
  }

  .safe-zone {
    position: absolute;
    inset: 32px;
    border: 1px dashed rgba(15, 23, 42, 0.35);
    border-radius: 18px;
    pointer-events: none;
    display: none;
  }

  .safe-zone::after {
    content: "Safe Zone";
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 0.7rem;
    color: rgba(15, 23, 42, 0.5);
  }

  .show-guides .safe-zone {
    display: block;
  }

  .shape {
    position: absolute;
    border-radius: 999px;
    opacity: 0.9;
  }

  .t-1 .shape-one { background: #fde68a; width: 200px; height: 200px; top: -60px; right: -60px; }
  .t-1 .shape-two { background: #d1fae5; width: 180px; height: 180px; bottom: -60px; left: -40px; }

  .t-2 { background: linear-gradient(140deg, #fff7ed 0%, #fdf2f8 100%); }
  .t-2 .shape-one { background: #f97316; width: 140px; height: 140px; top: 40px; right: 40px; }
  .t-2 .shape-two { background: #0ea5a6; width: 160px; height: 160px; bottom: 30px; left: 30px; }

  .t-3 { background: #0f172a; color: #ffffff; }
  .t-3 .ad-tagline { color: #e2e8f0; }
  .t-3 .ad-cta { background: #f97316; }
  .t-3 .shape-one { background: #22d3ee; width: 220px; height: 220px; top: -80px; right: -70px; }
  .t-3 .shape-two { background: #f59e0b; width: 120px; height: 120px; bottom: -20px; left: -20px; }

  .t-4 { background: #f8fafc; }
  .t-4 .ad-panel { background: #ffffff; border-radius: 16px; padding: 20px; box-shadow: 0 16px 32px rgba(15,23,42,0.1); }
  .t-4 .shape-one { background: #fca5a5; width: 160px; height: 160px; top: -40px; right: 40px; }

  .t-5 { background: linear-gradient(140deg, #ecfeff 0%, #fef3c7 100%); }
  .t-5 .shape-one { background: #38bdf8; width: 190px; height: 190px; top: -50px; left: -50px; }
  .t-5 .shape-two { background: #f59e0b; width: 160px; height: 160px; bottom: -60px; right: -30px; }

  .t-6 { background: #fff1f2; }
  .t-6 .shape-one { background: #fb7185; width: 140px; height: 140px; top: 20px; right: 30px; }
  .t-6 .shape-two { background: #fda4af; width: 180px; height: 180px; bottom: -60px; left: -40px; }

  .t-7 { background: #f0fdf4; }
  .t-7 .shape-one { background: #22c55e; width: 160px; height: 160px; top: -30px; right: -30px; }
  .t-7 .shape-two { background: #86efac; width: 180px; height: 180px; bottom: -60px; left: -40px; }

  .t-8 { background: #fefce8; }
  .t-8 .shape-one { background: #facc15; width: 140px; height: 140px; top: 30px; right: 50px; }
  .t-8 .shape-two { background: #fde047; width: 170px; height: 170px; bottom: -50px; left: -40px; }

  .t-9 { background: #eff6ff; }
  .t-9 .shape-one { background: #38bdf8; width: 160px; height: 160px; top: -20px; right: -20px; }
  .t-9 .shape-two { background: #f97316; width: 140px; height: 140px; bottom: -40px; left: -20px; }

  .t-10 { background: #ffffff; }
  .t-10 .shape-one { background: #111827; width: 140px; height: 140px; top: 24px; right: 24px; }
  .t-10 .shape-two { background: #f97316; width: 180px; height: 180px; bottom: -60px; left: -40px; }

  .ad-layout {
    position: absolute;
    inset: 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.2rem;
    padding: 90px 42px 42px;
    align-items: center;
  }

  .ad-stack {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
  }

  .ad-features {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    font-size: 0.95rem;
  }

  .ratio-pill {
    border: 1px solid #e5e7eb;
    border-radius: 999px;
    padding: 0.35rem 0.8rem;
    font-weight: 600;
    background: #ffffff;
  }

  .ratio-pill.active {
    background: var(--studio-ink);
    color: #ffffff;
  }

  @media (max-width: 992px) {
    .template-grid {
      grid-template-columns: 1fr;
    }
    .ad-layout {
      grid-template-columns: 1fr;
      padding: 90px 32px 32px;
    }
    .ad-product-img {
      width: 200px;
      height: 260px;
    }
    .product-visual {
      width: 200px;
      height: 260px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="studio-header d-flex flex-wrap justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-1">Marketing Studio</h4>
    <div class="studio-subtext">Generate Instagram banners, ad copy, and export PNG in one place.</div>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-5">
    <div class="studio-card card mb-4">
      <div class="card-header">
        <strong>Brand + Product Inputs</strong>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label class="studio-label">Brand Name</label>
          <input id="brandName" class="form-control studio-input" value="VibeMall" />
        </div>
        <div class="mb-3">
          <label class="studio-label">Product Name</label>
          <input id="productName" class="form-control studio-input" placeholder="Floral Co-ord Set" />
        </div>
        <div class="mb-3">
          <label class="studio-label">Category</label>
          <input id="productCategory" class="form-control studio-input" placeholder="Women Wear" />
        </div>
        <div class="row g-2 mb-3">
          <div class="col-6">
            <label class="studio-label">Price</label>
            <input id="productPrice" class="form-control studio-input" placeholder="799" />
          </div>
          <div class="col-6">
            <label class="studio-label">Discount</label>
            <input id="productDiscount" class="form-control studio-input" placeholder="20% OFF" />
          </div>
        </div>
        <div class="mb-3">
          <label class="studio-label">Highlight</label>
          <input id="productHighlight" class="form-control studio-input" placeholder="Soft cotton. All day comfort." />
        </div>
        <div class="mb-3">
          <label class="studio-label">Tagline</label>
          <input id="productTagline" class="form-control studio-input" placeholder="Own your everyday glam." />
        </div>
        <div class="mb-3">
          <label class="studio-label">CTA</label>
          <input id="productCTA" class="form-control studio-input" value="Shop Now" />
        </div>
        <div class="mb-3">
          <label class="studio-label">Product Image</label>
          <input id="productImageInput" type="file" accept="image/*" class="form-control studio-input" />
        </div>
        <div class="form-check">
          <input id="toggleLogo" class="form-check-input" type="checkbox" checked />
          <label class="form-check-label" for="toggleLogo">Show brand logo</label>
        </div>
      </div>
    </div>

    <div class="studio-card card mb-4">
      <div class="card-header">
        <strong>Style Controls</strong>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <div class="studio-label mb-2">Palette presets</div>
          <div class="palette-grid" id="paletteGrid">
            <button class="palette-btn active" data-palette="sunset">Sunset Pop</button>
            <button class="palette-btn" data-palette="mint">Mint Fresh</button>
            <button class="palette-btn" data-palette="noir">Noir Luxe</button>
            <button class="palette-btn" data-palette="rose">Soft Rose</button>
          </div>
        </div>
        <div class="mb-3">
          <div class="studio-label mb-2">Font pairs</div>
          <div class="palette-grid" id="fontGrid">
            <button class="font-btn active" data-font="grotesk-playfair">Grotesk + Playfair</button>
            <button class="font-btn" data-font="syne-dm">Syne + DM Sans</button>
            <button class="font-btn" data-font="dm-playfair">DM Sans + Playfair</button>
            <button class="font-btn" data-font="syne-playfair">Syne + Playfair</button>
          </div>
        </div>
        <div class="mb-3">
          <div class="studio-label mb-2">Badge library</div>
          <div class="palette-grid" id="badgeGrid">
            <button class="badge-btn" data-badge="New Drop">New Drop</button>
            <button class="badge-btn" data-badge="Limited">Limited</button>
            <button class="badge-btn" data-badge="Best Seller">Best Seller</button>
            <button class="badge-btn" data-badge="Only Today">Only Today</button>
          </div>
        </div>
        <div class="mb-3">
          <div class="studio-label mb-2">CTA variants</div>
          <div class="palette-grid" id="ctaGrid">
            <button class="cta-btn" data-cta="Shop the Drop">Shop the Drop</button>
            <button class="cta-btn" data-cta="Tap to Try">Tap to Try</button>
            <button class="cta-btn" data-cta="Style It Today">Style It Today</button>
            <button class="cta-btn" data-cta="Add to Closet">Add to Closet</button>
          </div>
        </div>
        <div class="mb-3">
          <label class="studio-label">UGC Handle</label>
          <input id="ugcHandleInput" class="form-control studio-input" placeholder="@yourcustomer" />
        </div>
        <div class="row g-2">
          <div class="col-6 form-check">
            <input id="toggleGuides" class="form-check-input" type="checkbox" />
            <label class="form-check-label" for="toggleGuides">Show safe zone</label>
          </div>
          <div class="col-6 form-check">
            <input id="toggleUGC" class="form-check-input" type="checkbox" />
            <label class="form-check-label" for="toggleUGC">UGC frame</label>
          </div>
          <div class="col-6 form-check">
            <input id="toggleBeforeAfter" class="form-check-input" type="checkbox" />
            <label class="form-check-label" for="toggleBeforeAfter">Before / After</label>
          </div>
          <div class="col-6 form-check">
            <input id="lockPrice" class="form-check-input" type="checkbox" />
            <label class="form-check-label" for="lockPrice">Lock price</label>
          </div>
          <div class="col-6 form-check">
            <input id="lockBadge" class="form-check-input" type="checkbox" />
            <label class="form-check-label" for="lockBadge">Lock badge</label>
          </div>
          <div class="col-6 form-check">
            <input id="lockLogo" class="form-check-input" type="checkbox" />
            <label class="form-check-label" for="lockLogo">Lock logo</label>
          </div>
        </div>
      </div>
    </div>

    <div class="studio-card card mb-4">
      <div class="card-header">
        <strong>Idea Generator</strong>
      </div>
      <div class="card-body">
        <button id="generateIdeas" class="btn btn-outline-primary mb-3">Generate Ideas</button>
        <textarea id="ideaOutput" class="form-control idea-output" readonly></textarea>
      </div>
    </div>

    <div class="studio-card card">
      <div class="card-header">
        <strong>Ad Copy Generator</strong>
      </div>
      <div class="card-body">
        <button id="generateCopy" class="btn btn-outline-dark mb-3">Generate Copy</button>
        <textarea id="copyOutput" class="form-control copy-output" readonly></textarea>
      </div>
    </div>

    <div class="studio-card card mt-4">
      <div class="card-header">
        <strong>Hashtag Generator</strong>
      </div>
      <div class="card-body">
        <button id="generateHashtags" class="btn btn-outline-primary mb-3">Generate Hashtags</button>
        <textarea id="hashtagOutput" class="form-control copy-output" readonly></textarea>
      </div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="studio-card card mb-4">
      <div class="card-header d-flex flex-wrap gap-2 justify-content-between align-items-center">
        <strong>Templates</strong>
        <div class="d-flex gap-2">
          <button class="ratio-pill active" data-ratio="square">Square</button>
          <button class="ratio-pill" data-ratio="portrait">Portrait</button>
          <button class="ratio-pill" data-ratio="story">Story</button>
        </div>
      </div>
      <div class="card-body">
        <div class="d-flex flex-wrap gap-2 mb-3" id="templateFilters">
          <button class="filter-pill active" data-filter="all">All</button>
          <button class="filter-pill" data-filter="drop">Drop</button>
          <button class="filter-pill" data-filter="minimal">Minimal</button>
          <button class="filter-pill" data-filter="soft">Soft</button>
          <button class="filter-pill" data-filter="bold">Bold</button>
          <button class="filter-pill" data-filter="street">Street</button>
        </div>
        <div class="template-grid" id="templateGrid">
          <button class="template-btn active" data-template="t-1" data-category="drop">Warm Editorial</button>
          <button class="template-btn" data-template="t-2" data-category="drop">Pop Contrast</button>
          <button class="template-btn" data-template="t-3" data-category="bold">Night Luxe</button>
          <button class="template-btn" data-template="t-4" data-category="minimal">Minimal Split</button>
          <button class="template-btn" data-template="t-5" data-category="street">Fresh Breeze</button>
          <button class="template-btn" data-template="t-6" data-category="soft">Soft Romance</button>
          <button class="template-btn" data-template="t-7" data-category="soft">Eco Chic</button>
          <button class="template-btn" data-template="t-8" data-category="drop">Sunrise Drop</button>
          <button class="template-btn" data-template="t-9" data-category="street">City Glow</button>
          <button class="template-btn" data-template="t-10" data-category="bold">Bold Mono</button>
        </div>
      </div>
    </div>

    <div class="studio-card card">
      <div class="card-header d-flex flex-wrap gap-2 justify-content-between align-items-center">
        <strong>Banner Preview</strong>
        <div class="d-flex gap-2">
          <button id="applyToPreview" class="btn btn-outline-secondary">Update Preview</button>
          <button id="downloadBanner" class="btn btn-primary">Download PNG</button>
          <button id="downloadAll" class="btn btn-outline-primary">Export All</button>
          <button id="downloadCarousel" class="btn btn-outline-dark">Export Carousel</button>
        </div>
      </div>
      <div class="card-body">
        <div class="ad-stage">
          <div id="adCanvas" class="ad-canvas t-1">
            <div class="shape shape-one"></div>
            <div class="shape shape-two"></div>
            <div class="safe-zone" id="safeZone"></div>
            <div class="ugc-frame" id="ugcFrame">
              <div class="ugc-label" id="ugcLabel">Styled by @you</div>
            </div>
            <div class="before-after-label before-label">Before</div>
            <div class="before-after-label after-label">After</div>

            <div class="brand-logo" id="brandLogoWrap">
              {% if site_settings and site_settings.admin_logo %}
              <img src="{{ site_settings.admin_logo.url }}" alt="{{ site_settings.site_name }}" />
              {% elif site_settings and site_settings.site_logo %}
              <img src="{{ site_settings.site_logo.url }}" alt="{{ site_settings.site_name }}" />
              {% endif %}
              <span id="brandText">VibeMall</span>
            </div>

            <div class="ad-badge" id="badgeDiscount">20% OFF</div>

            <div class="ad-layout">
              <div class="ad-stack">
                <div class="ad-title" id="headlineText">Floral Co-ord Set</div>
                <div class="ad-tagline" id="taglineText">Own your everyday glam.</div>
                <div class="ad-features">
                  <span id="categoryText">Women Wear</span>
                  <span id="highlightText">Soft cotton. All day comfort.</span>
                </div>
                <div class="ad-price">Price: Rs <span id="priceText">799</span></div>
                <div class="ad-cta" id="ctaText">Shop Now</div>
              </div>
              <div class="d-flex justify-content-center">
                <div class="product-visual">
                  <img id="productImage" class="ad-product-img product-image" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='320'><rect width='100%' height='100%' fill='%23e2e8f0'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%2394a3b8' font-family='Arial' font-size='16'>Upload Image</text></svg>" alt="Product" />
                  <img id="productImageAlt" class="ad-product-img product-image-alt" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='320'><rect width='100%' height='100%' fill='%23e2e8f0'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%2394a3b8' font-family='Arial' font-size='16'>Upload Image</text></svg>" alt="Product alternate" />
                  <div class="before-after-divider"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <small class="text-muted d-block mt-2">Tip: Use a 1080px product image for best results.</small>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  const ideaOutput = document.getElementById("ideaOutput");
  const copyOutput = document.getElementById("copyOutput");
  const hashtagOutput = document.getElementById("hashtagOutput");
  const adCanvas = document.getElementById("adCanvas");
  const safeZone = document.getElementById("safeZone");
  const ugcLabel = document.getElementById("ugcLabel");
  const ugcHandleInput = document.getElementById("ugcHandleInput");

  const fields = {
    brand: document.getElementById("brandName"),
    name: document.getElementById("productName"),
    category: document.getElementById("productCategory"),
    price: document.getElementById("productPrice"),
    discount: document.getElementById("productDiscount"),
    highlight: document.getElementById("productHighlight"),
    tagline: document.getElementById("productTagline"),
    cta: document.getElementById("productCTA")
  };

  const preview = {
    brandText: document.getElementById("brandText"),
    headline: document.getElementById("headlineText"),
    category: document.getElementById("categoryText"),
    price: document.getElementById("priceText"),
    highlight: document.getElementById("highlightText"),
    tagline: document.getElementById("taglineText"),
    cta: document.getElementById("ctaText"),
    badge: document.getElementById("badgeDiscount"),
    image: document.getElementById("productImage"),
    imageAlt: document.getElementById("productImageAlt"),
    logoWrap: document.getElementById("brandLogoWrap")
  };

  const locks = {
    price: false,
    badge: false,
    logo: false
  };

  const palettes = {
    sunset: {
      ink: "#1f2937",
      muted: "#6b7280",
      accent: "#ff6b35",
      accent2: "#0ea5a6",
      bg: "#fff7ed"
    },
    mint: {
      ink: "#0f172a",
      muted: "#64748b",
      accent: "#14b8a6",
      accent2: "#22c55e",
      bg: "#ecfeff"
    },
    noir: {
      ink: "#f8fafc",
      muted: "#cbd5f5",
      accent: "#f97316",
      accent2: "#38bdf8",
      bg: "#0f172a"
    },
    rose: {
      ink: "#1f2937",
      muted: "#6b7280",
      accent: "#fb7185",
      accent2: "#f97316",
      bg: "#fff1f2"
    }
  };

  const fontPairs = {
    "grotesk-playfair": {
      body: "'Space Grotesk', sans-serif",
      title: "'Playfair Display', serif"
    },
    "syne-dm": {
      body: "'DM Sans', sans-serif",
      title: "'Syne', sans-serif"
    },
    "dm-playfair": {
      body: "'DM Sans', sans-serif",
      title: "'Playfair Display', serif"
    },
    "syne-playfair": {
      body: "'Syne', sans-serif",
      title: "'Playfair Display', serif"
    }
  };

  const hooks = [
    "Weekend-ready in 5 seconds",
    "From desk to dinner",
    "Soft on skin, sharp on style",
    "Minimal effort, max impact",
    "Genz approved, comfort powered"
  ];
  const benefits = [
    "breathable fabric",
    "easy fit",
    "all-day comfort",
    "statement detail",
    "premium finish"
  ];
  const emotions = [
    "confidence",
    "ease",
    "everyday glam",
    "street-ready",
    "vacay mood"
  ];
  const ctas = ["Shop Now", "Grab the Drop", "Style It Today", "Add to Closet", "Order Now"];

  function buildIdeas() {
    const product = fields.name.value || "your product";
    const lines = [];
    for (let i = 0; i < 6; i += 1) {
      const idea = `${hooks[i % hooks.length]}: ${product} with ${benefits[i % benefits.length]} for ${emotions[i % emotions.length]}.`;
      lines.push(`${i + 1}. ${idea}`);
    }
    ideaOutput.value = lines.join("\n");
  }

  function buildCopy() {
    const product = fields.name.value || "New Arrival";
    const category = fields.category.value || "Women Wear";
    const price = fields.price.value || "799";
    const discount = fields.discount.value || "20% OFF";
    const pickCta = ctas[Math.floor(Math.random() * ctas.length)];

    const headline = `${product}, made for ${emotions[Math.floor(Math.random() * emotions.length)]}`;
    const caption = `${category} that feels like ${benefits[Math.floor(Math.random() * benefits.length)]}. Limited drop at Rs ${price}. ${discount}.`;

    copyOutput.value = `Headline: ${headline}\nCaption: ${caption}\nCTA: ${pickCta}`;

    if (!fields.tagline.value) fields.tagline.value = headline;
    if (!fields.highlight.value) fields.highlight.value = caption;
    if (!fields.cta.value) fields.cta.value = pickCta;
    updatePreview();
  }

  function buildHashtags() {
    const brand = (fields.brand.value || "VibeMall").replace(/\s+/g, "");
    const category = (fields.category.value || "WomenWear").replace(/\s+/g, "");
    const product = (fields.name.value || "NewDrop").replace(/\s+/g, "");
    const baseTags = [
      "#indianfashion",
      "#ootd",
      "#genzstyle",
      "#streetstyle",
      "#trendalert",
      "#newarrival",
      "#womenwear",
      "#styleinspo",
      "#fashionindia",
      "#closetgoals",
      "#lookbook",
      "#dailywear",
      "#vibestyle",
      "#wardrobe",
      "#fashionstore"
    ];
    const customTags = [`#${brand}`, `#${category}`, `#${product}`];
    const tags = customTags.concat(baseTags.slice(0, 12)).join(" ");
    hashtagOutput.value = tags;
  }

  function updatePreview() {
    if (!locks.logo) {
      preview.brandText.textContent = fields.brand.value || "VibeMall";
    }
    preview.headline.textContent = fields.name.value || "Floral Co-ord Set";
    preview.category.textContent = fields.category.value || "Women Wear";
    if (!locks.price) {
      preview.price.textContent = fields.price.value || "799";
    }
    preview.highlight.textContent = fields.highlight.value || "Soft cotton. All day comfort.";
    preview.tagline.textContent = fields.tagline.value || "Own your everyday glam.";
    preview.cta.textContent = fields.cta.value || "Shop Now";
    if (!locks.badge) {
      preview.badge.textContent = fields.discount.value || "20% OFF";
    }
    const handleText = ugcHandleInput.value.trim();
    if (handleText) {
      ugcLabel.textContent = `Styled by ${handleText}`;
    } else {
      ugcLabel.textContent = fields.brand.value ? `Styled by @${fields.brand.value.replace(/\s+/g, "")}` : "Styled by @you";
    }
  }

  function setTemplate(template) {
    Array.from(adCanvas.classList)
      .filter((cls) => cls.startsWith("t-"))
      .forEach((cls) => adCanvas.classList.remove(cls));
    adCanvas.classList.add(template);
    document.querySelectorAll(".template-btn").forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.template === template);
    });
  }

  function setRatio(ratio) {
    let width = 540;
    let height = 540;
    if (ratio === "portrait") {
      height = 675;
    }
    if (ratio === "story") {
      height = 960;
    }
    adCanvas.style.setProperty("--canvas-w", `${width}px`);
    adCanvas.style.setProperty("--canvas-h", `${height}px`);
    document.querySelectorAll(".ratio-pill").forEach((pill) => {
      pill.classList.toggle("active", pill.dataset.ratio === ratio);
    });
  }

  function applyPalette(paletteKey) {
    const palette = palettes[paletteKey];
    if (!palette) return;
    adCanvas.style.setProperty("--ink", palette.ink);
    adCanvas.style.setProperty("--muted", palette.muted);
    adCanvas.style.setProperty("--accent", palette.accent);
    adCanvas.style.setProperty("--accent-2", palette.accent2);
    adCanvas.style.setProperty("--canvas-bg", palette.bg);
  }

  function applyFonts(fontKey) {
    const pair = fontPairs[fontKey];
    if (!pair) return;
    adCanvas.style.setProperty("--font-body", pair.body);
    adCanvas.style.setProperty("--font-title", pair.title);
  }

  function setGuidesVisible(isVisible) {
    adCanvas.classList.toggle("show-guides", isVisible);
  }

  function setUGC(isEnabled) {
    adCanvas.classList.toggle("ugc-on", isEnabled);
  }

  function setBeforeAfter(isEnabled) {
    adCanvas.classList.toggle("mode-before-after", isEnabled);
  }

  function syncLocks() {
    document.getElementById("productPrice").disabled = locks.price;
    document.getElementById("productDiscount").disabled = locks.badge;
    document.getElementById("brandName").disabled = locks.logo;
    document.getElementById("toggleLogo").disabled = locks.logo;
  }

  async function renderDownload(fileName) {
    const guidesOn = adCanvas.classList.contains("show-guides");
    setGuidesVisible(false);
    const canvas = await html2canvas(adCanvas, {
      scale: 2,
      useCORS: true,
      backgroundColor: null
    });
    const link = document.createElement("a");
    link.download = fileName;
    link.href = canvas.toDataURL("image/png");
    link.click();
    setGuidesVisible(guidesOn);
  }

  async function exportAllTemplates() {
    const buttons = Array.from(document.querySelectorAll(".template-btn"));
    const current = document.querySelector(".template-btn.active")?.dataset.template || "t-1";
    for (const button of buttons) {
      setTemplate(button.dataset.template);
      updatePreview();
      await new Promise((resolve) => setTimeout(resolve, 120));
      await renderDownload(`banner-${button.dataset.template}.png`);
    }
    setTemplate(current);
  }

  async function exportCarousel() {
    const original = {
      name: fields.name.value,
      tagline: fields.tagline.value,
      highlight: fields.highlight.value,
      category: fields.category.value,
      price: fields.price.value,
      discount: fields.discount.value,
      cta: fields.cta.value
    };
    const slides = [
      { name: original.name || "Hero Drop", tagline: "New season, new energy", highlight: "Limited quantity", cta: "Shop the Drop" },
      { name: "Fabric Detail", tagline: "Touch the texture", highlight: "Soft, breathable, premium", cta: "See the Detail" },
      { name: "Fit Check", tagline: "Designed to move", highlight: "Easy fit, all-day comfort", cta: "Try the Fit" },
      { name: "Color Options", tagline: "Pick your mood", highlight: "Multiple shades available", cta: "Choose a Color" },
      { name: "Final Call", tagline: "Ready to own it?", highlight: "Limited time offer", cta: "Checkout Now" }
    ];

    for (let i = 0; i < slides.length; i += 1) {
      fields.name.value = slides[i].name;
      fields.tagline.value = slides[i].tagline;
      fields.highlight.value = slides[i].highlight;
      fields.cta.value = slides[i].cta;
      updatePreview();
      await new Promise((resolve) => setTimeout(resolve, 120));
      await renderDownload(`carousel-${i + 1}.png`);
    }

    fields.name.value = original.name;
    fields.tagline.value = original.tagline;
    fields.highlight.value = original.highlight;
    fields.category.value = original.category;
    fields.price.value = original.price;
    fields.discount.value = original.discount;
    fields.cta.value = original.cta;
    updatePreview();
  }

  document.getElementById("generateIdeas").addEventListener("click", buildIdeas);
  document.getElementById("generateCopy").addEventListener("click", buildCopy);
  document.getElementById("generateHashtags").addEventListener("click", buildHashtags);
  document.getElementById("applyToPreview").addEventListener("click", updatePreview);

  document.getElementById("templateGrid").addEventListener("click", (event) => {
    const button = event.target.closest(".template-btn");
    if (!button) return;
    setTemplate(button.dataset.template);
  });

  document.getElementById("templateFilters").addEventListener("click", (event) => {
    const button = event.target.closest(".filter-pill");
    if (!button) return;
    const filter = button.dataset.filter;
    document.querySelectorAll(".filter-pill").forEach((pill) => {
      pill.classList.toggle("active", pill === button);
    });
    document.querySelectorAll(".template-btn").forEach((btn) => {
      const category = btn.dataset.category;
      btn.style.display = filter === "all" || category === filter ? "block" : "none";
    });
  });

  document.querySelectorAll(".ratio-pill").forEach((pill) => {
    pill.addEventListener("click", () => setRatio(pill.dataset.ratio));
  });

  document.getElementById("paletteGrid").addEventListener("click", (event) => {
    const button = event.target.closest(".palette-btn");
    if (!button) return;
    document.querySelectorAll(".palette-btn").forEach((btn) => btn.classList.remove("active"));
    button.classList.add("active");
    applyPalette(button.dataset.palette);
  });

  document.getElementById("fontGrid").addEventListener("click", (event) => {
    const button = event.target.closest(".font-btn");
    if (!button) return;
    document.querySelectorAll(".font-btn").forEach((btn) => btn.classList.remove("active"));
    button.classList.add("active");
    applyFonts(button.dataset.font);
  });

  document.getElementById("badgeGrid").addEventListener("click", (event) => {
    const button = event.target.closest(".badge-btn");
    if (!button) return;
    document.querySelectorAll(".badge-btn").forEach((btn) => btn.classList.remove("active"));
    button.classList.add("active");
    fields.discount.value = button.dataset.badge;
    updatePreview();
  });

  document.getElementById("ctaGrid").addEventListener("click", (event) => {
    const button = event.target.closest(".cta-btn");
    if (!button) return;
    document.querySelectorAll(".cta-btn").forEach((btn) => btn.classList.remove("active"));
    button.classList.add("active");
    fields.cta.value = button.dataset.cta;
    updatePreview();
  });

  document.getElementById("toggleLogo").addEventListener("change", (event) => {
    preview.logoWrap.style.display = event.target.checked ? "flex" : "none";
  });

  document.getElementById("toggleGuides").addEventListener("change", (event) => {
    setGuidesVisible(event.target.checked);
  });

  document.getElementById("toggleUGC").addEventListener("change", (event) => {
    setUGC(event.target.checked);
  });

  document.getElementById("toggleBeforeAfter").addEventListener("change", (event) => {
    setBeforeAfter(event.target.checked);
  });

  document.getElementById("ugcHandleInput").addEventListener("input", (event) => {
    const value = event.target.value.trim();
    ugcLabel.textContent = value ? `Styled by ${value}` : "Styled by @you";
  });

  document.getElementById("lockPrice").addEventListener("change", (event) => {
    locks.price = event.target.checked;
    syncLocks();
  });

  document.getElementById("lockBadge").addEventListener("change", (event) => {
    locks.badge = event.target.checked;
    syncLocks();
  });

  document.getElementById("lockLogo").addEventListener("change", (event) => {
    locks.logo = event.target.checked;
    syncLocks();
  });

  document.getElementById("productImageInput").addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      preview.image.src = e.target.result;
      preview.imageAlt.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });

  document.getElementById("downloadBanner").addEventListener("click", async () => {
    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, "-");
    updatePreview();
    await renderDownload(`banner-${timestamp}.png`);
  });

  document.getElementById("downloadAll").addEventListener("click", async () => {
    await exportAllTemplates();
  });

  document.getElementById("downloadCarousel").addEventListener("click", async () => {
    await exportCarousel();
  });

  applyPalette("sunset");
  applyFonts("grotesk-playfair");
  syncLocks();
  updatePreview();
</script>
{% endblock %}
